<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºèƒ½ç½‘ç›˜ç›´é“¾è½¬æ¢å™¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }

        .background-animation {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: 0;
        }

        .floating-shape {
            position: absolute;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            animation: float 6s ease-in-out infinite;
        }

        .floating-shape:nth-child(1) {
            width: 100px;
            height: 100px;
            top: 20%;
            left: 20%;
            animation-delay: 0s;
        }

        .floating-shape:nth-child(2) {
            width: 150px;
            height: 150px;
            top: 60%;
            right: 20%;
            animation-delay: 2s;
        }

        .floating-shape:nth-child(3) {
            width: 80px;
            height: 80px;
            bottom: 20%;
            left: 30%;
            animation-delay: 4s;
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0px) rotate(0deg);
            }

            50% {
                transform: translateY(-20px) rotate(180deg);
            }
        }

        .container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 40px;
            max-width: 650px;
            width: 100%;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
            z-index: 1;
            animation: slideUp 0.8s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            color: white;
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .header p {
            color: rgba(255, 255, 255, 0.8);
            font-size: 1.1rem;
            font-weight: 400;
        }

        .platform-indicators {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .platform-badge {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
        }

        .platform-badge:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .input-section {
            margin-bottom: 30px;
        }

        .input-wrapper {
            position: relative;
            margin-bottom: 20px;
        }

        .input-field {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 1rem;
            transition: all 0.3s ease;
            outline: none;
        }

        .input-field::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .input-field:focus {
            border-color: rgba(255, 255, 255, 0.5);
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .convert-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #ff6b6b, #ffa500);
            color: white;
            border: none;
            border-radius: 16px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .convert-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 30px rgba(255, 107, 107, 0.3);
        }

        .convert-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .convert-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .convert-btn:hover::before {
            left: 100%;
        }

        .result-section {
            margin-top: 30px;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.5s ease;
        }

        .result-section.show {
            opacity: 1;
            transform: translateY(0);
        }

        .result-wrapper {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .result-label {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
            margin-bottom: 10px;
            font-weight: 500;
        }

        .result-link {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 15px;
            color: white;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.9rem;
            word-break: break-all;
            margin-bottom: 15px;
            position: relative;
            max-height: 120px;
            overflow-y: auto;
        }

        .copy-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            padding: 10px 20px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.3s ease;
            margin-right: 10px;
        }

        .copy-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-1px);
        }

        .test-btn {
            background: rgba(76, 175, 80, 0.2);
            color: white;
            border: 1px solid rgba(76, 175, 80, 0.5);
            border-radius: 10px;
            padding: 10px 20px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .test-btn:hover {
            background: rgba(76, 175, 80, 0.3);
            transform: translateY(-1px);
        }

        .detection-info {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            border-left: 4px solid #4CAF50;
        }

        .detection-info h3 {
            color: white;
            font-size: 1rem;
            margin-bottom: 5px;
        }

        .detection-info p {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
        }

        .error-message {
            background: rgba(244, 67, 54, 0.2);
            border: 1px solid rgba(244, 67, 54, 0.5);
            border-radius: 12px;
            padding: 15px;
            color: white;
            margin-top: 15px;
            border-left: 4px solid #f44336;
        }

        .warning-message {
            background: rgba(255, 193, 7, 0.2);
            border: 1px solid rgba(255, 193, 7, 0.5);
            border-radius: 12px;
            padding: 15px;
            color: white;
            margin-top: 15px;
            border-left: 4px solid #ffc107;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .password-section {
            margin-bottom: 20px;
            animation: slideDown 0.3s ease-out;
        }

        .password-hint {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.85rem;
            margin-top: 8px;
            padding-left: 10px;
        }

        .options-section {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .checkbox-wrapper {
            display: flex;
            align-items: center;
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
            cursor: pointer;
            user-select: none;
        }

        .checkbox-wrapper input[type="checkbox"] {
            margin-right: 8px;
            transform: scale(1.2);
        }

        .short-link-info {
            background: rgba(33, 150, 243, 0.2);
            border: 1px solid rgba(33, 150, 243, 0.5);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            border-left: 4px solid #2196F3;
        }

        .batch-progress {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            display: none;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            width: 0%;
            transition: width 0.3s ease;
        }

        .batch-results {
            max-height: 200px;
            overflow-y: auto;
            margin-top: 10px;
        }

        .batch-item {
            padding: 8px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 0.85rem;
        }

        .batch-item.success {
            color: #4CAF50;
        }

        .batch-item.error {
            color: #f44336;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                max-height: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                max-height: 100px;
                transform: translateY(0);
            }
        }

        .footer {
            text-align: center;
            margin-top: 30px;
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .container {
                padding: 30px 20px;
                margin: 10px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .platform-indicators {
                gap: 8px;
            }

            .platform-badge {
                padding: 4px 8px;
                font-size: 0.7rem;
            }
        }
    </style>
</head>

<body>
    <div class="background-animation">
        <div class="floating-shape"></div>
        <div class="floating-shape"></div>
        <div class="floating-shape"></div>
    </div>

    <div class="container">
        <div class="header">
            <h1>ğŸ”— æ™ºèƒ½ç›´é“¾è½¬æ¢å™¨</h1>
            <p>æ”¯æŒä¸»æµç½‘ç›˜åˆ†äº«é“¾æ¥ä¸€é”®è½¬æ¢ä¸ºç›´æ¥ä¸‹è½½é“¾æ¥</p>
        </div>

        <div class="platform-indicators">
            <div class="platform-badge">Google Drive</div>
            <div class="platform-badge">OneDrive</div>
            <div class="platform-badge">Dropbox</div>
            <div class="platform-badge">ç™¾åº¦ç½‘ç›˜</div>
            <div class="platform-badge">è“å¥äº‘</div>
            <div class="platform-badge">å¤©ç¿¼äº‘</div>
            <div class="platform-badge">é˜¿é‡Œäº‘ç›˜</div>
            <div class="platform-badge">å¤¸å…‹ç½‘ç›˜</div>
            <div class="platform-badge">123äº‘ç›˜</div>
            <div class="platform-badge">åŸé€šç½‘ç›˜</div>
            <div class="platform-badge">MediaFire</div>
            <div class="platform-badge">MEGA</div>
            <div class="platform-badge">4shared</div>
            <div class="platform-badge">åšæœäº‘</div>
            <div class="platform-badge">TeraBox</div>
            <div class="platform-badge">WeTransfer</div>
            <div class="platform-badge">çŸ­é“¾æ¥å±•å¼€</div>
        </div>

        <div class="input-section">
            <div class="input-wrapper">
                <input type="text" class="input-field" id="shareLink" placeholder="è¯·ç²˜è´´ç½‘ç›˜åˆ†äº«é“¾æ¥...">
            </div>

            <!-- å¯†ç è¾“å…¥åŒºåŸŸ -->
            <div class="password-section" id="passwordSection" style="display: none;">
                <div class="input-wrapper">
                    <input type="text" class="input-field" id="extractCode" placeholder="è¯·è¾“å…¥æå–ç /å¯†ç ...">
                </div>
                <div class="password-hint" id="passwordHint"></div>
            </div>

            <!-- çŸ­é“¾æ¥å±•å¼€é€‰é¡¹ -->
            <div class="options-section">
                <label class="checkbox-wrapper">
                    <input type="checkbox" id="expandShortLinks" checked>
                    <span class="checkmark"></span>
                    è‡ªåŠ¨å±•å¼€çŸ­é“¾æ¥
                </label>
                <label class="checkbox-wrapper">
                    <input type="checkbox" id="batchMode">
                    <span class="checkmark"></span>
                    æ‰¹é‡å¤„ç†æ¨¡å¼
                </label>
            </div>

            <button class="convert-btn" onclick="convertLink()">
                <span id="convertText">ğŸš€ æ™ºèƒ½è½¬æ¢</span>
            </button>
        </div>

        <!-- çŸ­é“¾æ¥å±•å¼€ä¿¡æ¯ -->
        <div id="shortLinkInfo" class="short-link-info" style="display: none;">
            <h3>ğŸ”— çŸ­é“¾æ¥å±•å¼€</h3>
            <p id="shortLinkDetails"></p>
        </div>

        <!-- æ‰¹é‡å¤„ç†è¿›åº¦ -->
        <div id="batchProgress" class="batch-progress">
            <h3>ğŸ“Š æ‰¹é‡å¤„ç†è¿›åº¦</h3>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div id="batchStatus">å‡†å¤‡ä¸­...</div>
            <div class="batch-results" id="batchResults"></div>
        </div>

        <div class="result-section" id="resultSection">
            <div id="detectionInfo" class="detection-info" style="display: none;">
                <h3 id="detectedPlatform"></h3>
                <p id="detectedType"></p>
            </div>

            <div class="result-wrapper">
                <div class="result-label">ç›´æ¥ä¸‹è½½é“¾æ¥ï¼š</div>
                <div class="result-link" id="resultLink"></div>
                <button class="copy-btn" onclick="copyToClipboard()">ğŸ“‹ å¤åˆ¶é“¾æ¥</button>
                <button class="test-btn" onclick="testLink()">ğŸ” æµ‹è¯•é“¾æ¥</button>
                <button class="copy-btn" onclick="copyAllResults()" id="copyAllBtn" style="display: none;">ğŸ“‹
                    å¤åˆ¶å…¨éƒ¨</button>
                <button class="test-btn" onclick="testAllLinks()" id="testAllBtn" style="display: none;">ğŸ”
                    æµ‹è¯•å…¨éƒ¨</button>
            </div>
        </div>

        <div id="errorMessage" class="error-message" style="display: none;"></div>
        <div id="warningMessage" class="warning-message" style="display: none;"></div>

        <div class="footer">
            <p>ğŸ’¡ æ”¯æŒè‡ªåŠ¨è¯†åˆ«ç½‘ç›˜ç±»å‹ â€¢ ä¸€é”®è½¬æ¢ â€¢ å®‰å…¨å¯é </p>
        </div>
    </div>

    <script>
        // çŸ­é“¾æ¥æœåŠ¡é…ç½®
        const shortLinkServices = {
            'bit.ly': {
                name: 'Bitly',
                expandUrl: 'https://api.bitly.com/v4/expand',
                method: 'POST'
            },
            'tinyurl.com': {
                name: 'TinyURL',
                expandUrl: 'https://tinyurl.com/api-create.php?alias=',
                method: 'GET'
            },
            't.co': {
                name: 'Twitter',
                expandUrl: 'https://t.co/',
                method: 'HEAD'
            },
            'short.link': {
                name: 'Short.link',
                expandUrl: 'https://short.link/api/expand',
                method: 'GET'
            },
            'is.gd': {
                name: 'Is.gd',
                expandUrl: 'https://is.gd/forward.php?format=simple&shorturl=',
                method: 'GET'
            }
        };

        // ç½‘ç›˜å¹³å°é…ç½®
        const platforms = {
            'drive.google.com': {
                name: 'Google Drive',
                icon: 'ğŸ—‚ï¸',
                patterns: [
                    {
                        regex: /drive\.google\.com\/file\/d\/([a-zA-Z0-9_-]+)/,
                        converter: (match) => `https://drive.google.com/uc?export=download&id=${match[1]}`
                    },
                    {
                        regex: /drive\.google\.com\/open\?id=([a-zA-Z0-9_-]+)/,
                        converter: (match) => `https://drive.google.com/uc?export=download&id=${match[1]}`
                    }
                ]
            },
            'onedrive.live.com': {
                name: 'OneDrive',
                icon: 'â˜ï¸',
                patterns: [
                    {
                        regex: /onedrive\.live\.com\/.*redir\?resid=([^&]+)/,
                        converter: (match) => `https://onedrive.live.com/download?resid=${match[1]}`
                    },
                    {
                        regex: /1drv\.ms\/[a-zA-Z]\/([a-zA-Z0-9_-]+)/,
                        converter: (match, originalUrl) => {
                            // å…ˆé‡å®šå‘åˆ°åŸå§‹é“¾æ¥ï¼Œç„¶åè½¬æ¢
                            return originalUrl.replace('1drv.ms', 'onedrive.live.com/download?cid=');
                        }
                    },
                    {
                        regex: /onedrive\.live\.com\/.*\/([a-zA-Z0-9_-]+)\.([a-zA-Z0-9]+)\?/,
                        converter: (match, originalUrl) => originalUrl.replace('redir?', 'download?')
                    }
                ]
            },
            'dropbox.com': {
                name: 'Dropbox',
                icon: 'ğŸ“¦',
                patterns: [
                    {
                        regex: /dropbox\.com\/s\/([a-zA-Z0-9_-]+)/,
                        converter: (match, originalUrl) => {
                            return originalUrl.replace('www.dropbox.com', 'dl.dropboxusercontent.com')
                                .replace('dropbox.com', 'dl.dropboxusercontent.com')
                                .replace('?dl=0', '')
                                .replace('?dl=1', '');
                        }
                    },
                    {
                        regex: /dropbox\.com\/scl\/fi\/([^?]+)/,
                        converter: (match, originalUrl) => {
                            return originalUrl.replace('www.dropbox.com', 'dl.dropboxusercontent.com')
                                .replace('dropbox.com', 'dl.dropboxusercontent.com')
                                .replace('?dl=0', '')
                                .replace('?dl=1', '');
                        }
                    }
                ]
            },
            'pan.baidu.com': {
                name: 'ç™¾åº¦ç½‘ç›˜',
                icon: 'ğŸ’¾',
                needsPassword: true,
                requiresSpecialHandling: true,
                patterns: [
                    {
                        regex: /pan\.baidu\.com\/s\/([a-zA-Z0-9_-]+)/,
                        converter: async (match, originalUrl, password) => {
                            const shareId = match[1];
                            if (password) {
                                // å°è¯•é€šè¿‡ç¬¬ä¸‰æ–¹è§£ææœåŠ¡
                                return await parseBaiduPan(shareId, password, originalUrl);
                            }
                            return {
                                type: 'redirect',
                                url: originalUrl,
                                message: 'è¯·æ‰‹åŠ¨è®¿é—®é“¾æ¥å¹¶è¾“å…¥æå–ç '
                            };
                        }
                    }
                ]
            },
            'lanzou.com': {
                name: 'è“å¥äº‘',
                icon: 'ğŸŒ¥ï¸',
                needsPassword: false, // æ”¹ä¸ºå¯é€‰
                requiresSpecialHandling: true,
                patterns: [
                    {
                        regex: /lanzou[a-z]?\.com\/([a-zA-Z0-9_-]+)/,
                        converter: async (match, originalUrl, password) => {
                            const fileId = match[1];
                            return await parseLanzouCloud(fileId, originalUrl, password);
                        }
                    },
                    {
                        regex: /lanzou[a-z]?\.com\/i([a-zA-Z0-9_-]+)/,
                        converter: async (match, originalUrl, password) => {
                            const fileId = match[1];
                            return await parseLanzouCloud('i' + fileId, originalUrl, password);
                        }
                    }
                ]
            },
            'cloud.189.cn': {
                name: 'å¤©ç¿¼äº‘',
                icon: 'â˜ï¸',
                patterns: [
                    {
                        regex: /cloud\.189\.cn\/t\/([a-zA-Z0-9_-]+)/,
                        converter: (match, originalUrl) => {
                            const shareId = match[1];
                            return `https://cloud.189.cn/api/open/file/getFileDownloadUrl.action?shareId=${shareId}`;
                        }
                    }
                ]
            },
            'aliyundrive.com': {
                name: 'é˜¿é‡Œäº‘ç›˜',
                icon: 'ğŸ’¿',
                patterns: [
                    {
                        regex: /aliyundrive\.com\/s\/([a-zA-Z0-9_-]+)/,
                        converter: (match, originalUrl) => {
                            const shareId = match[1];
                            return `https://api.aliyundrive.com/v2/file/get_download_url?share_id=${shareId}`;
                        }
                    }
                ]
            },
            'pan.quark.cn': {
                name: 'å¤¸å…‹ç½‘ç›˜',
                icon: 'ğŸš€',
                patterns: [
                    {
                        regex: /pan\.quark\.cn\/s\/([a-zA-Z0-9_-]+)/,
                        converter: (match, originalUrl) => {
                            const shareId = match[1];
                            return `https://pan.quark.cn/api/file/share/download?share_id=${shareId}`;
                        }
                    }
                ]
            },
            '123pan.com': {
                name: '123äº‘ç›˜',
                icon: 'ğŸ“Š',
                patterns: [
                    {
                        regex: /123pan\.com\/s\/([a-zA-Z0-9_-]+)/,
                        converter: (match, originalUrl) => {
                            const shareId = match[1];
                            return `https://123pan.com/api/file/download_info?share_key=${shareId}`;
                        }
                    }
                ]
            },
            'ctfile.com': {
                name: 'åŸé€šç½‘ç›˜',
                icon: 'ğŸ°',
                patterns: [
                    {
                        regex: /ctfile\.com\/f\/([a-zA-Z0-9_-]+)/,
                        converter: (match, originalUrl) => {
                            const fileId = match[1];
                            return `https://webapi.ctfile.com/getfile.php?path=${fileId}`;
                        }
                    }
                ]
            },
            'weiyun.com': {
                name: 'å¾®äº‘',
                icon: 'â˜ï¸',
                patterns: [
                    {
                        regex: /weiyun\.com\/([a-zA-Z0-9_-]+)/,
                        converter: (match, originalUrl) => {
                            const shareId = match[1];
                            return `https://weiyun.com/api/share/download?share_key=${shareId}`;
                        }
                    }
                ]
            },
            'cowtransfer.com': {
                name: 'å¥¶ç‰›å¿«ä¼ ',
                icon: 'ğŸ„',
                patterns: [
                    {
                        regex: /cowtransfer\.com\/s\/([a-zA-Z0-9_-]+)/,
                        converter: (match, originalUrl) => {
                            const shareId = match[1];
                            return `https://cowtransfer.com/api/transfer/download?transferId=${shareId}`;
                        }
                    }
                ]
            }
        };

        let currentResult = '';
        let currentPlatform = '';

        async function convertLink() {
            const input = document.getElementById('shareLink');
            const url = input.value.trim();
            const batchMode = document.getElementById('batchMode').checked;
            const expandShortLinks = document.getElementById('expandShortLinks').checked;
            const convertBtn = document.querySelector('.convert-btn');
            const convertText = document.getElementById('convertText');
            const resultSection = document.getElementById('resultSection');
            const errorMessage = document.getElementById('errorMessage');
            const warningMessage = document.getElementById('warningMessage');
            const detectionInfo = document.getElementById('detectionInfo');
            const shortLinkInfo = document.getElementById('shortLinkInfo');
            const batchProgress = document.getElementById('batchProgress');

            // æ¸…é™¤ä¹‹å‰çš„ç»“æœ
            errorMessage.style.display = 'none';
            warningMessage.style.display = 'none';
            resultSection.classList.remove('show');
            detectionInfo.style.display = 'none';
            shortLinkInfo.style.display = 'none';
            batchProgress.style.display = 'none';

            if (!url) {
                showError('è¯·è¾“å…¥ç½‘ç›˜åˆ†äº«é“¾æ¥');
                return;
            }

            // æ£€æŸ¥æ˜¯å¦ä¸ºæ‰¹é‡æ¨¡å¼
            if (batchMode || url.includes('\n')) {
                await processBatchLinks(url);
                return;
            }

            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            convertText.innerHTML = '<span class="loading"></span>è½¬æ¢ä¸­...';
            convertBtn.disabled = true;

            try {
                let processedUrl = url;

                // çŸ­é“¾æ¥å±•å¼€
                if (expandShortLinks && isShortLink(url)) {
                    showShortLinkInfo('æ­£åœ¨å±•å¼€çŸ­é“¾æ¥...');
                    processedUrl = await expandShortLink(url);
                    if (processedUrl !== url) {
                        showShortLinkInfo(`çŸ­é“¾æ¥å·²å±•å¼€: ${processedUrl.substring(0, 50)}...`);
                    }
                }

                if (!isValidUrl(processedUrl)) {
                    showError('è¯·è¾“å…¥æœ‰æ•ˆçš„ç½‘ç›˜é“¾æ¥');
                    return;
                }

                const result = await processLink(processedUrl);
                if (result.success) {
                    showResult(result);
                    if (result.warning) {
                        showWarning(result.warning);
                    }
                } else {
                    showError(result.error);
                }
            } catch (error) {
                showError('è½¬æ¢å¤±è´¥ï¼Œè¯·æ£€æŸ¥é“¾æ¥æ ¼å¼: ' + error.message);
            } finally {
                // æ¢å¤æŒ‰é’®çŠ¶æ€
                convertText.innerHTML = 'ğŸš€ æ™ºèƒ½è½¬æ¢';
                convertBtn.disabled = false;
            }
        }

        function isValidUrl(string) {
            try {
                new URL(string);
                return true;
            } catch (_) {
                return false;
            }
        }

        // çŸ­é“¾æ¥æ£€æµ‹
        function isShortLink(url) {
            const shortDomains = Object.keys(shortLinkServices);
            return shortDomains.some(domain => url.includes(domain));
        }

        // çŸ­é“¾æ¥å±•å¼€
        async function expandShortLink(url) {
            try {
                // ä½¿ç”¨é€šç”¨çš„é‡å®šå‘è·Ÿè¸ªæ–¹æ³•
                const response = await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(url)}`);
                if (response.ok) {
                    const data = await response.json();
                    // å°è¯•ä»å“åº”ä¸­æå–é‡å®šå‘URL
                    const redirectMatch = data.contents.match(/location\.href\s*=\s*["']([^"']+)["']/i);
                    if (redirectMatch) {
                        return redirectMatch[1];
                    }
                }

                // å¤‡ç”¨æ–¹æ³•ï¼šå°è¯•ç›´æ¥è®¿é—®å¹¶è·å–æœ€ç»ˆURL
                return await expandUrlFallback(url);
            } catch (error) {
                console.warn('çŸ­é“¾æ¥å±•å¼€å¤±è´¥:', error);
                return url; // è¿”å›åŸå§‹URL
            }
        }

        // å¤‡ç”¨å±•å¼€æ–¹æ³•
        async function expandUrlFallback(url) {
            try {
                // åˆ›å»ºä¸€ä¸ªéšè—çš„iframeæ¥è·å–æœ€ç»ˆURL
                return new Promise((resolve) => {
                    const iframe = document.createElement('iframe');
                    iframe.style.display = 'none';
                    iframe.onload = () => {
                        try {
                            const finalUrl = iframe.contentWindow.location.href;
                            document.body.removeChild(iframe);
                            resolve(finalUrl !== 'about:blank' ? finalUrl : url);
                        } catch (e) {
                            document.body.removeChild(iframe);
                            resolve(url);
                        }
                    };
                    iframe.onerror = () => {
                        document.body.removeChild(iframe);
                        resolve(url);
                    };
                    document.body.appendChild(iframe);
                    iframe.src = url;

                    // è¶…æ—¶å¤„ç†
                    setTimeout(() => {
                        if (iframe.parentNode) {
                            document.body.removeChild(iframe);
                            resolve(url);
                        }
                    }, 5000);
                });
            } catch (error) {
                return url;
            }
        }

        // æ˜¾ç¤ºçŸ­é“¾æ¥ä¿¡æ¯
        function showShortLinkInfo(message) {
            const shortLinkInfo = document.getElementById('shortLinkInfo');
            const shortLinkDetails = document.getElementById('shortLinkDetails');
            shortLinkDetails.textContent = message;
            shortLinkInfo.style.display = 'block';
        }

        // ç™¾åº¦ç½‘ç›˜è§£æ
        async function parseBaiduPan(shareId, password, originalUrl) {
            try {
                // æ–¹æ³•1: ç”Ÿæˆå®ç”¨çš„è®¿é—®é“¾æ¥
                const accessUrls = [
                    // ç›´æ¥è®¿é—®åˆ†äº«é¡µé¢
                    originalUrl,
                    // ç§»åŠ¨ç«¯è®¿é—®ï¼ˆæœ‰æ—¶æ›´å®¹æ˜“è·å–ä¸‹è½½é“¾æ¥ï¼‰
                    `https://pan.baidu.com/mbox/msg/share?uk=0&shareid=${shareId}&pwd=${password}`,
                    // APIæ¥å£ï¼ˆéœ€è¦è¿›ä¸€æ­¥å¤„ç†ï¼‰
                    `https://pan.baidu.com/api/sharedownload?shareid=${shareId}&pwd=${password}`
                ];

                // æ–¹æ³•2: æä¾›å®ç”¨çš„ä½¿ç”¨è¯´æ˜
                const instructions = [
                    "1. ç‚¹å‡»ç¬¬ä¸€ä¸ªé“¾æ¥è®¿é—®åˆ†äº«é¡µé¢",
                    "2. è¾“å…¥æå–ç : " + password,
                    "3. é€‰æ‹©æ–‡ä»¶åç‚¹å‡»ä¸‹è½½",
                    "4. å¦‚æœç¬¬ä¸€ä¸ªé“¾æ¥æ— æ•ˆï¼Œè¯·å°è¯•å…¶ä»–é“¾æ¥"
                ];

                return {
                    type: 'multiple',
                    urls: accessUrls,
                    message: 'ç™¾åº¦ç½‘ç›˜éœ€è¦æ‰‹åŠ¨æ“ä½œï¼Œè¯·æŒ‰ä»¥ä¸‹æ­¥éª¤ï¼š\n' + instructions.join('\n')
                };

            } catch (error) {
                return {
                    type: 'error',
                    message: 'ç™¾åº¦ç½‘ç›˜è§£æå¤±è´¥ï¼Œå»ºè®®ç›´æ¥è®¿é—®åŸé“¾æ¥'
                };
            }
        }

        // è“å¥äº‘è§£æ
        async function parseLanzouCloud(fileId, originalUrl, password) {
            try {
                // æå–åŸŸåå’Œæ–‡ä»¶ID
                const urlMatch = originalUrl.match(/https?:\/\/([^\/]+)\/(.+)/);
                if (!urlMatch) {
                    throw new Error('æ— æ•ˆçš„è“å¥äº‘é“¾æ¥');
                }

                const domain = urlMatch[1];
                const path = urlMatch[2];

                // ç”Ÿæˆå¤šç§å¯èƒ½çš„è®¿é—®æ–¹å¼
                const accessMethods = [
                    {
                        url: originalUrl,
                        description: "åŸå§‹åˆ†äº«é“¾æ¥ï¼ˆæ¨èï¼‰"
                    },
                    {
                        url: `https://${domain}/tp/${path}`,
                        description: "ç›´æ¥ä¸‹è½½é“¾æ¥1"
                    },
                    {
                        url: `https://${domain}/file/${path}`,
                        description: "ç›´æ¥ä¸‹è½½é“¾æ¥2"
                    }
                ];

                // å¦‚æœæœ‰å¯†ç ï¼Œæ·»åŠ å¸¦å¯†ç çš„é“¾æ¥
                if (password) {
                    accessMethods.push({
                        url: `${originalUrl}?pwd=${password}`,
                        description: "å¸¦å¯†ç çš„åˆ†äº«é“¾æ¥"
                    });
                }

                // æ·»åŠ ä¸€äº›å¸¸ç”¨çš„è“å¥äº‘é•œåƒåŸŸå
                const mirrorDomains = ['lanzous.com', 'lanzoux.com', 'lanzoui.com'];
                mirrorDomains.forEach(mirror => {
                    if (mirror !== domain) {
                        accessMethods.push({
                            url: `https://${mirror}/${path}`,
                            description: `é•œåƒé“¾æ¥ (${mirror})`
                        });
                    }
                });

                const urls = accessMethods.map(method => method.url);
                const descriptions = accessMethods.map((method, index) =>
                    `${index + 1}. ${method.description}: ${method.url}`
                ).join('\n');

                return {
                    type: 'multiple',
                    urls: urls,
                    message: `è“å¥äº‘å¤šé“¾æ¥è§£æå®Œæˆï¼š\n${descriptions}\n\nå»ºè®®ä¼˜å…ˆå°è¯•ç¬¬ä¸€ä¸ªé“¾æ¥`
                };

            } catch (error) {
                return {
                    type: 'error',
                    message: 'è“å¥äº‘è§£æå¤±è´¥: ' + error.message
                };
            }
        }

        // å¤©ç¿¼äº‘è§£æ
        async function parseCloud189(shareId, originalUrl, password) {
            try {
                // å¤©ç¿¼äº‘çš„APIè°ƒç”¨éœ€è¦å¤æ‚çš„è®¤è¯
                const apiUrls = [
                    `https://cloud.189.cn/api/open/file/getFileDownloadUrl.action?shareId=${shareId}`,
                    `https://cloud.189.cn/api/portal/getFileInfo.action?shareId=${shareId}`
                ];

                return {
                    type: 'multiple',
                    urls: apiUrls,
                    message: 'å¤©ç¿¼äº‘éœ€è¦ç™»å½•è®¤è¯ï¼Œå»ºè®®æ‰‹åŠ¨ä¸‹è½½'
                };
            } catch (error) {
                return {
                    type: 'error',
                    message: 'å¤©ç¿¼äº‘è§£æå¤±è´¥'
                };
            }
        }

        async function processLink(url) {
            const extractCode = document.getElementById('extractCode').value.trim();

            // æ£€æµ‹å¹³å°
            for (const [domain, platform] of Object.entries(platforms)) {
                if (url.includes(domain)) {
                    // æ£€æŸ¥æ˜¯å¦éœ€è¦å¯†ç 
                    if (platform.needsPassword && !extractCode) {
                        showPasswordSection(platform.name);
                        return {
                            success: false,
                            error: `${platform.name} éœ€è¦æå–ç ï¼Œè¯·è¾“å…¥åé‡è¯•`
                        };
                    }

                    // å°è¯•åŒ¹é…æ¨¡å¼
                    for (const pattern of platform.patterns) {
                        const match = url.match(pattern.regex);
                        if (match) {
                            let result;

                            // æ£€æŸ¥æ˜¯å¦éœ€è¦ç‰¹æ®Šå¤„ç†
                            if (platform.requiresSpecialHandling) {
                                result = await pattern.converter(match, url, extractCode);

                                // å¤„ç†ç‰¹æ®Šè¿”å›ç±»å‹
                                if (typeof result === 'object' && result.type) {
                                    return await handleSpecialResult(result, platform, url);
                                }
                            } else {
                                result = pattern.converter(match, url, extractCode);
                            }

                            const directLink = typeof result === 'string' ? result : result.url || result;
                            let warning = null;

                            // ä¸ºæŸäº›å¹³å°æ·»åŠ è­¦å‘Šä¿¡æ¯
                            if (domain === 'pan.baidu.com') {
                                warning = extractCode ?
                                    'ç™¾åº¦ç½‘ç›˜è§£æå®Œæˆï¼Œå¦‚é“¾æ¥æ— æ•ˆè¯·å°è¯•æ‰‹åŠ¨ä¸‹è½½' :
                                    'ç™¾åº¦ç½‘ç›˜éœ€è¦æå–ç ï¼Œè¯·è¾“å…¥åé‡è¯•';
                            } else if (domain.includes('lanzou')) {
                                warning = 'è“å¥äº‘è§£æå®Œæˆï¼Œå¦‚é“¾æ¥æ— æ•ˆè¯·å°è¯•å…¶ä»–é“¾æ¥';
                            } else if (domain === 'cloud.189.cn' || domain === 'aliyundrive.com' || domain === 'pan.quark.cn') {
                                warning = 'æ­¤é“¾æ¥ä¸ºAPIæ¥å£ï¼Œéœ€è¦ç›¸åº”çš„è®¤è¯æ‰èƒ½ç›´æ¥ä¸‹è½½';
                            }

                            return {
                                success: true,
                                platform: platform.name,
                                icon: platform.icon,
                                directLink: directLink,
                                originalUrl: url,
                                warning: warning,
                                hasPassword: !!extractCode
                            };
                        }
                    }
                }
            }

            // å°è¯•é€šç”¨è½¬æ¢
            const genericResult = tryGenericConversion(url);
            if (genericResult.success) {
                return genericResult;
            }

            return {
                success: false,
                error: 'æš‚ä¸æ”¯æŒè¯¥ç½‘ç›˜æˆ–é“¾æ¥æ ¼å¼ä¸æ­£ç¡®'
            };
        }

        function tryGenericConversion(url) {
            // å°è¯•ä¸€äº›é€šç”¨çš„è½¬æ¢æ–¹æ³•
            if (url.includes('?dl=0')) {
                return {
                    success: true,
                    platform: 'é€šç”¨è½¬æ¢',
                    icon: 'ğŸ”„',
                    directLink: url.replace('?dl=0', '?dl=1'),
                    originalUrl: url,
                    warning: 'å·²å°è¯•é€šç”¨è½¬æ¢ï¼Œå¯èƒ½éœ€è¦æ‰‹åŠ¨éªŒè¯'
                };
            }

            if (url.includes('drive.google.com') && url.includes('view?usp=sharing')) {
                const fileId = url.match(/\/d\/([a-zA-Z0-9_-]+)/);
                if (fileId) {
                    return {
                        success: true,
                        platform: 'Google Drive',
                        icon: 'ğŸ—‚ï¸',
                        directLink: `https://drive.google.com/uc?export=download&id=${fileId[1]}`,
                        originalUrl: url
                    };
                }
            }

            return { success: false };
        }

        // å¤„ç†ç‰¹æ®Šè§£æç»“æœ
        async function handleSpecialResult(result, platform, originalUrl) {
            switch (result.type) {
                case 'multiple':
                    // å¤šä¸ªå¯èƒ½çš„é“¾æ¥
                    return {
                        success: true,
                        platform: platform.name,
                        icon: platform.icon,
                        directLink: result.urls.join('\n'),
                        originalUrl: originalUrl,
                        warning: result.message,
                        isMultiple: true
                    };

                case 'needPassword':
                    // éœ€è¦å¯†ç 
                    showPasswordSection(platform.name);
                    return {
                        success: false,
                        error: result.message
                    };

                case 'redirect':
                    // éœ€è¦é‡å®šå‘
                    return {
                        success: true,
                        platform: platform.name,
                        icon: platform.icon,
                        directLink: result.url,
                        originalUrl: originalUrl,
                        warning: result.message,
                        isRedirect: true
                    };

                case 'error':
                    // è§£æé”™è¯¯
                    return {
                        success: false,
                        error: result.message
                    };

                default:
                    return {
                        success: false,
                        error: 'æœªçŸ¥çš„è§£æç»“æœç±»å‹'
                    };
            }
        }

        function showResult(result) {
            const resultSection = document.getElementById('resultSection');
            const resultLink = document.getElementById('resultLink');
            const detectionInfo = document.getElementById('detectionInfo');
            const detectedPlatform = document.getElementById('detectedPlatform');
            const detectedType = document.getElementById('detectedType');
            const copyAllBtn = document.getElementById('copyAllBtn');
            const testAllBtn = document.getElementById('testAllBtn');

            // æ˜¾ç¤ºæ£€æµ‹ä¿¡æ¯
            detectedPlatform.textContent = `${result.icon} ${result.platform}`;

            if (result.isMultiple) {
                detectedType.textContent = 'å·²ç”Ÿæˆå¤šä¸ªå¯èƒ½çš„ä¸‹è½½é“¾æ¥ï¼Œè¯·é€ä¸ªå°è¯•';
                copyAllBtn.style.display = 'inline-block';
                testAllBtn.style.display = 'inline-block';
            } else if (result.isRedirect) {
                detectedType.textContent = 'éœ€è¦æ‰‹åŠ¨è®¿é—®é“¾æ¥å®Œæˆä¸‹è½½';
            } else {
                detectedType.textContent = 'å·²è‡ªåŠ¨è¯†åˆ«å¹³å°å¹¶è½¬æ¢ä¸ºç›´é“¾';
            }

            detectionInfo.style.display = 'block';

            // æ˜¾ç¤ºç»“æœ
            if (result.isMultiple) {
                // å¤šé“¾æ¥æ ¼å¼åŒ–æ˜¾ç¤º
                const links = result.directLink.split('\n');
                resultLink.innerHTML = links.map((link, index) =>
                    `<div style="margin-bottom: 8px; padding: 8px; background: rgba(255,255,255,0.05); border-radius: 6px;">
                        <strong>é“¾æ¥ ${index + 1}:</strong><br>
                        <span style="font-size: 0.85em; word-break: break-all;">${link}</span>
                    </div>`
                ).join('');
            } else {
                resultLink.textContent = result.directLink;
            }

            currentResult = result.directLink;
            currentPlatform = result.platform;

            resultSection.classList.add('show');
        }

        function showError(message) {
            const errorMessage = document.getElementById('errorMessage');
            errorMessage.textContent = message;
            errorMessage.style.display = 'block';
        }

        function showWarning(message) {
            const warningMessage = document.getElementById('warningMessage');
            warningMessage.textContent = `âš ï¸ ${message}`;
            warningMessage.style.display = 'block';
        }

        // æ˜¾ç¤ºå¯†ç è¾“å…¥åŒºåŸŸ
        function showPasswordSection(platformName) {
            const passwordSection = document.getElementById('passwordSection');
            const passwordHint = document.getElementById('passwordHint');
            passwordHint.textContent = `æ£€æµ‹åˆ° ${platformName}ï¼Œè¯·è¾“å…¥æå–ç æˆ–å¯†ç `;
            passwordSection.style.display = 'block';
        }

        // éšè—å¯†ç è¾“å…¥åŒºåŸŸ
        function hidePasswordSection() {
            const passwordSection = document.getElementById('passwordSection');
            passwordSection.style.display = 'none';
        }

        // æ‰¹é‡å¤„ç†é“¾æ¥
        async function processBatchLinks(input) {
            const urls = input.split('\n').filter(url => url.trim());
            if (urls.length <= 1) {
                showError('æ‰¹é‡æ¨¡å¼éœ€è¦å¤šä¸ªé“¾æ¥ï¼Œæ¯è¡Œä¸€ä¸ª');
                return;
            }

            const batchProgress = document.getElementById('batchProgress');
            const progressFill = document.getElementById('progressFill');
            const batchStatus = document.getElementById('batchStatus');
            const batchResults = document.getElementById('batchResults');
            const copyAllBtn = document.getElementById('copyAllBtn');

            batchProgress.style.display = 'block';
            batchResults.innerHTML = '';

            const results = [];
            let successCount = 0;
            let errorCount = 0;

            for (let i = 0; i < urls.length; i++) {
                const url = urls[i].trim();
                const progress = ((i + 1) / urls.length) * 100;

                progressFill.style.width = `${progress}%`;
                batchStatus.textContent = `å¤„ç†ä¸­ ${i + 1}/${urls.length}: ${url.substring(0, 30)}...`;

                try {
                    let processedUrl = url;

                    // çŸ­é“¾æ¥å±•å¼€
                    if (document.getElementById('expandShortLinks').checked && isShortLink(url)) {
                        processedUrl = await expandShortLink(url);
                    }

                    const result = await processLink(processedUrl);

                    if (result.success) {
                        results.push(result.directLink);
                        successCount++;
                        addBatchResult(url, result.directLink, 'success');
                    } else {
                        errorCount++;
                        addBatchResult(url, result.error, 'error');
                    }
                } catch (error) {
                    errorCount++;
                    addBatchResult(url, 'è½¬æ¢å¤±è´¥: ' + error.message, 'error');
                }

                // æ·»åŠ å»¶è¿Ÿé¿å…è¯·æ±‚è¿‡å¿«
                await new Promise(resolve => setTimeout(resolve, 500));
            }

            batchStatus.textContent = `å®Œæˆï¼æˆåŠŸ: ${successCount}, å¤±è´¥: ${errorCount}`;

            if (results.length > 0) {
                currentResult = results.join('\n');
                copyAllBtn.style.display = 'inline-block';
                document.getElementById('resultLink').textContent = `æ‰¹é‡è½¬æ¢å®Œæˆï¼Œå…± ${results.length} ä¸ªé“¾æ¥`;
                document.getElementById('resultSection').classList.add('show');
            }
        }

        // æ·»åŠ æ‰¹é‡ç»“æœé¡¹
        function addBatchResult(originalUrl, result, type) {
            const batchResults = document.getElementById('batchResults');
            const item = document.createElement('div');
            item.className = `batch-item ${type}`;
            item.innerHTML = `
                <strong>${originalUrl.substring(0, 40)}...</strong><br>
                <small>${result.substring(0, 60)}...</small>
            `;
            batchResults.appendChild(item);
            batchResults.scrollTop = batchResults.scrollHeight;
        }

        function copyToClipboard() {
            if (currentResult) {
                copyText(currentResult, document.querySelector('.copy-btn'));
            }
        }

        function copyAllResults() {
            if (currentResult) {
                copyText(currentResult, document.getElementById('copyAllBtn'));
            }
        }

        function copyText(text, button) {
            navigator.clipboard.writeText(text).then(() => {
                const originalText = button.textContent;
                button.textContent = 'âœ… å·²å¤åˆ¶';
                button.style.background = 'rgba(76, 175, 80, 0.3)';

                setTimeout(() => {
                    button.textContent = originalText;
                    button.style.background = 'rgba(255, 255, 255, 0.2)';
                }, 2000);
            }).catch(() => {
                // é™çº§å¤åˆ¶æ–¹æ³•
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);

                const originalText = button.textContent;
                button.textContent = 'âœ… å·²å¤åˆ¶';
                button.style.background = 'rgba(76, 175, 80, 0.3)';

                setTimeout(() => {
                    button.textContent = originalText;
                    button.style.background = 'rgba(255, 255, 255, 0.2)';
                }, 2000);
            });
        }

        function testLink() {
            if (currentResult) {
                if (currentResult.includes('api') || currentResult.includes('éœ€è¦') || currentResult.includes('å¯†ç ')) {
                    alert('è¯¥é“¾æ¥ä¸ºAPIæ¥å£æˆ–éœ€è¦é¢å¤–è®¤è¯ï¼Œæ— æ³•ç›´æ¥æµ‹è¯•');
                    return;
                }

                const testBtn = document.querySelector('.test-btn');
                const originalText = testBtn.textContent;
                testBtn.textContent = 'ğŸ” æµ‹è¯•ä¸­...';

                // åˆ›å»ºä¸€ä¸ªéšè—çš„iframeæ¥æµ‹è¯•é“¾æ¥
                const iframe = document.createElement('iframe');
                iframe.style.display = 'none';
                iframe.src = currentResult;
                document.body.appendChild(iframe);

                // è®¾ç½®è¶…æ—¶
                setTimeout(() => {
                    document.body.removeChild(iframe);
                    testBtn.textContent = 'âœ… æµ‹è¯•å®Œæˆ';

                    setTimeout(() => {
                        testBtn.textContent = originalText;
                    }, 2000);
                }, 3000);

                // åŒæ—¶åœ¨æ–°çª—å£æ‰“å¼€
                window.open(currentResult, '_blank');
            }
        }

        function testAllLinks() {
            if (currentResult && currentResult.includes('\n')) {
                const links = currentResult.split('\n').filter(link => link.trim());
                const testAllBtn = document.getElementById('testAllBtn');
                const originalText = testAllBtn.textContent;

                testAllBtn.textContent = `ğŸ” æµ‹è¯•ä¸­... (0/${links.length})`;

                // é€ä¸ªæ‰“å¼€é“¾æ¥ï¼Œé—´éš”1ç§’
                links.forEach((link, index) => {
                    setTimeout(() => {
                        window.open(link.trim(), '_blank');
                        testAllBtn.textContent = `ğŸ” æµ‹è¯•ä¸­... (${index + 1}/${links.length})`;

                        if (index === links.length - 1) {
                            setTimeout(() => {
                                testAllBtn.textContent = 'âœ… å…¨éƒ¨æµ‹è¯•å®Œæˆ';
                                setTimeout(() => {
                                    testAllBtn.textContent = originalText;
                                }, 3000);
                            }, 500);
                        }
                    }, index * 1000);
                });

                showInfo(`å°†åœ¨æ–°çª—å£ä¸­æ‰“å¼€ ${links.length} ä¸ªé“¾æ¥ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨å¼¹çª—è®¾ç½®`);
            } else {
                testLink();
            }
        }

        // é«˜çº§è½¬æ¢åŠŸèƒ½
        function advancedConversion(url) {
            // å¤„ç†çŸ­é“¾æ¥
            if (url.includes('bit.ly') || url.includes('tinyurl.com') || url.includes('t.co')) {
                return {
                    success: false,
                    error: 'æ£€æµ‹åˆ°çŸ­é“¾æ¥ï¼Œè¯·å…ˆå±•å¼€ä¸ºå®Œæ•´é“¾æ¥'
                };
            }

            // å¤„ç†åŠ å¯†é“¾æ¥
            if (url.includes('å¯†ç ') || url.includes('æå–ç ')) {
                return {
                    success: false,
                    error: 'æ£€æµ‹åˆ°åŠ å¯†é“¾æ¥ï¼Œè¯·æä¾›æå–ç '
                };
            }

            return { success: false };
        }



        // é“¾æ¥éªŒè¯åŠŸèƒ½
        function validateLink(url) {
            // æ£€æŸ¥é“¾æ¥æ˜¯å¦æœ‰æ•ˆ
            if (!url || url.length < 10) {
                return false;
            }

            // æ£€æŸ¥æ˜¯å¦ä¸ºç½‘ç›˜é“¾æ¥
            const netdiskDomains = [
                'drive.google.com', 'onedrive.live.com', 'dropbox.com',
                'pan.baidu.com', 'lanzou', 'cloud.189.cn',
                'aliyundrive.com', 'pan.quark.cn', '123pan.com',
                'ctfile.com', 'weiyun.com', 'cowtransfer.com'
            ];

            return netdiskDomains.some(domain => url.includes(domain));
        }

        // è‡ªåŠ¨è¯†åˆ«å¹¶æç¤º
        function autoDetectPlatform(url) {
            for (const [domain, platform] of Object.entries(platforms)) {
                if (url.includes(domain)) {
                    return platform;
                }
            }
            return null;
        }

        // æ”¯æŒå›è½¦é”®è½¬æ¢
        document.getElementById('shareLink').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                convertLink();
            }
        });

        // å¯†ç è¾“å…¥æ¡†å›è½¦é”®æ”¯æŒ
        document.getElementById('extractCode').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                convertLink();
            }
        });

        // ç›‘å¬è¾“å…¥å˜åŒ–ï¼Œè‡ªåŠ¨æ£€æµ‹æ˜¯å¦éœ€è¦å¯†ç 
        document.getElementById('shareLink').addEventListener('input', function () {
            const url = this.value.trim();
            if (url && validateLink(url)) {
                const platform = autoDetectPlatform(url);
                if (platform && platform.needsPassword) {
                    showPasswordSection(platform.name);
                } else {
                    hidePasswordSection();
                }

                // å®æ—¶é¢„è§ˆ
                if (platform) {
                    showInfo(`æ£€æµ‹åˆ° ${platform.icon} ${platform.name}`);
                }
            } else {
                hidePasswordSection();
            }
        });

        // è‡ªåŠ¨ç²˜è´´åŠŸèƒ½
        document.getElementById('shareLink').addEventListener('focus', function () {
            if (this.value === '') {
                navigator.clipboard.readText().then(text => {
                    if (text && validateLink(text)) {
                        this.value = text;
                        // è‡ªåŠ¨æ˜¾ç¤ºæ£€æµ‹åˆ°çš„å¹³å°
                        const platform = autoDetectPlatform(text);
                        if (platform) {
                            showInfo(`æ£€æµ‹åˆ° ${platform.icon} ${platform.name} é“¾æ¥`);
                        }
                    }
                }).catch(() => {
                    // é™é»˜å¤±è´¥
                });
            }
        });

        // æ‹–æ‹½ä¸Šä¼ åŠŸèƒ½
        document.addEventListener('dragover', function (e) {
            e.preventDefault();
        });

        document.addEventListener('drop', function (e) {
            e.preventDefault();
            const text = e.dataTransfer.getData('text');
            if (validateLink(text)) {
                document.getElementById('shareLink').value = text;
                convertLink();
            }
        });

        // æ˜¾ç¤ºä¿¡æ¯æç¤º
        function showInfo(message) {
            const infoDiv = document.createElement('div');
            infoDiv.className = 'info-toast';
            infoDiv.textContent = message;
            infoDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: rgba(76, 175, 80, 0.9);
                color: white;
                padding: 10px 20px;
                border-radius: 8px;
                z-index: 1000;
                animation: slideIn 0.3s ease-out;
            `;

            document.body.appendChild(infoDiv);

            setTimeout(() => {
                infoDiv.remove();
            }, 3000);
        }

        // æ·»åŠ å¿«æ·é”®æ”¯æŒ
        document.addEventListener('keydown', function (e) {
            if (e.ctrlKey && e.key === 'v') {
                // Ctrl+V è‡ªåŠ¨ç²˜è´´å¹¶è½¬æ¢
                setTimeout(() => {
                    const input = document.getElementById('shareLink');
                    if (input.value && validateLink(input.value)) {
                        convertLink();
                    }
                }, 100);
            }
        });

        // é“¾æ¥å†å²è®°å½•
        let linkHistory = [];

        function saveToHistory(originalUrl, directLink, platform) {
            const historyItem = {
                original: originalUrl,
                direct: directLink,
                platform: platform,
                timestamp: new Date().toISOString()
            };

            linkHistory.unshift(historyItem);
            if (linkHistory.length > 10) {
                linkHistory.pop();
            }

            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            try {
                // ç”±äºä¸èƒ½ä½¿ç”¨localStorageï¼Œä½¿ç”¨å†…å­˜å­˜å‚¨
                window.linkHistory = linkHistory;
            } catch (e) {
                // é™é»˜å¤±è´¥
            }
        }

        // æ˜¾ç¤ºå†å²è®°å½•
        function showHistory() {
            if (linkHistory.length === 0) {
                showInfo('æš‚æ— è½¬æ¢å†å²');
                return;
            }

            const historyHtml = linkHistory.map((item, index) =>
                `<div class="history-item" onclick="useHistoryItem(${index})">
                    <strong>${item.platform}</strong><br>
                    <small>${item.original.substring(0, 50)}...</small>
                </div>`
            ).join('');

            // è¿™é‡Œå¯ä»¥æ˜¾ç¤ºå†å²è®°å½•çš„æ¨¡æ€æ¡†
            showInfo('å†å²è®°å½•åŠŸèƒ½å¯åœ¨æ§åˆ¶å°æŸ¥çœ‹');
            console.log('è½¬æ¢å†å²:', linkHistory);
        }

        // ä½¿ç”¨å†å²è®°å½•é¡¹
        function useHistoryItem(index) {
            const item = linkHistory[index];
            if (item) {
                document.getElementById('shareLink').value = item.original;
                currentResult = item.direct;
                showResult({
                    platform: item.platform,
                    icon: 'ğŸ“‹',
                    directLink: item.direct,
                    originalUrl: item.original
                });
            }
        }

        // URLå‚æ•°æ”¯æŒ
        function checkUrlParams() {
            const urlParams = new URLSearchParams(window.location.search);
            const shareUrl = urlParams.get('url');
            if (shareUrl) {
                document.getElementById('shareLink').value = decodeURIComponent(shareUrl);
                convertLink();
            }
        }

        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥URLå‚æ•°
        window.addEventListener('load', checkUrlParams);

        // æ·»åŠ æ›´å¤šå¹³å°æ”¯æŒ
        const additionalPlatforms = {
            '4shared.com': {
                name: '4shared',
                icon: 'ğŸ“',
                patterns: [
                    {
                        regex: /4shared\.com\/file\/([a-zA-Z0-9_-]+)/,
                        converter: (match, originalUrl) => {
                            const fileId = match[1];
                            return `https://4shared.com/get/${fileId}`;
                        }
                    }
                ]
            },
            'uploaded.net': {
                name: 'Uploaded',
                icon: 'â¬†ï¸',
                patterns: [
                    {
                        regex: /uploaded\.net\/file\/([a-zA-Z0-9_-]+)/,
                        converter: (match, originalUrl) => {
                            const fileId = match[1];
                            return `https://uploaded.net/file/${fileId}/download`;
                        }
                    }
                ]
            },
            'jianguoyun.com': {
                name: 'åšæœäº‘',
                icon: 'ğŸ¥œ',
                patterns: [
                    {
                        regex: /jianguoyun\.com\/p\/([a-zA-Z0-9_-]+)/,
                        converter: (match, originalUrl) => {
                            const shareId = match[1];
                            return `https://jianguoyun.com/api/share/download?share_id=${shareId}`;
                        }
                    }
                ]
            },
            'terabox.com': {
                name: 'TeraBox',
                icon: 'ğŸ“¦',
                patterns: [
                    {
                        regex: /terabox\.com\/s\/([a-zA-Z0-9_-]+)/,
                        converter: (match, originalUrl) => {
                            const shareId = match[1];
                            return `https://terabox.com/api/download?share_id=${shareId}`;
                        }
                    }
                ]
            },
            'send.firefox.com': {
                name: 'Firefox Send',
                icon: 'ğŸ¦Š',
                patterns: [
                    {
                        regex: /send\.firefox\.com\/download\/([a-zA-Z0-9_-]+)/,
                        converter: (match, originalUrl) => {
                            return originalUrl; // Firefox Send æœ¬èº«å°±æ˜¯ç›´é“¾
                        }
                    }
                ]
            },
            'wetransfer.com': {
                name: 'WeTransfer',
                icon: 'ğŸ“¤',
                patterns: [
                    {
                        regex: /wetransfer\.com\/downloads\/([a-zA-Z0-9_-]+)/,
                        converter: (match, originalUrl) => {
                            const transferId = match[1];
                            return `https://wetransfer.com/api/v4/transfers/${transferId}/download`;
                        }
                    }
                ]
            },
            'sendspace.com': {
                name: 'SendSpace',
                icon: 'ğŸš€',
                patterns: [
                    {
                        regex: /sendspace\.com\/file\/([a-zA-Z0-9_-]+)/,
                        converter: (match, originalUrl) => {
                            const fileId = match[1];
                            return `https://sendspace.com/file/${fileId}/download`;
                        }
                    }
                ]
            },
            'mediafire.com': {
                name: 'MediaFire',
                icon: 'ğŸ”¥',
                patterns: [
                    {
                        regex: /mediafire\.com\/file\/([a-zA-Z0-9_-]+)/,
                        converter: (match, originalUrl) => {
                            const fileId = match[1];
                            return `https://download${Math.floor(Math.random() * 1000)}.mediafire.com/file/${fileId}`;
                        }
                    }
                ]
            },
            'mega.nz': {
                name: 'MEGA',
                icon: 'ğŸ›¡ï¸',
                patterns: [
                    {
                        regex: /mega\.nz\/#!([a-zA-Z0-9_-]+)!([a-zA-Z0-9_-]+)/,
                        converter: (match, originalUrl) => {
                            return `https://mega.nz/api/download?id=${match[1]}&key=${match[2]}`;
                        }
                    }
                ]
            },
            'zippyshare.com': {
                name: 'ZippyShare',
                icon: 'âš¡',
                patterns: [
                    {
                        regex: /zippyshare\.com\/v\/([a-zA-Z0-9_-]+)/,
                        converter: (match, originalUrl) => {
                            const fileId = match[1];
                            return `https://zippyshare.com/download/${fileId}`;
                        }
                    }
                ]
            }
        };

        // åˆå¹¶å¹³å°é…ç½®
        Object.assign(platforms, additionalPlatforms);

        // æ›´æ–°å¹³å°æŒ‡ç¤ºå™¨
        function updatePlatformIndicators() {
            const platformsContainer = document.querySelector('.platform-indicators');
            const additionalBadges = Object.values(additionalPlatforms).map(platform =>
                `<div class="platform-badge">${platform.name}</div>`
            ).join('');

            platformsContainer.innerHTML += additionalBadges;
        }

        // é¡µé¢åŠ è½½å®Œæˆåæ›´æ–°æŒ‡ç¤ºå™¨
        window.addEventListener('load', updatePlatformIndicators);

        // æ€§èƒ½ä¼˜åŒ–ï¼šé˜²æŠ–å¤„ç†
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // åº”ç”¨é˜²æŠ–åˆ°è½¬æ¢å‡½æ•°
        const debouncedConvert = debounce(convertLink, 300);

        // å®æ—¶é¢„è§ˆåŠŸèƒ½
        document.getElementById('shareLink').addEventListener('input', function () {
            const url = this.value.trim();
            if (url && validateLink(url)) {
                const platform = autoDetectPlatform(url);
                if (platform) {
                    showInfo(`æ£€æµ‹åˆ° ${platform.icon} ${platform.name}`);
                }
            }
        });

        // é”™è¯¯ä¸ŠæŠ¥åŠŸèƒ½
        function reportError(error, url) {
            console.error('è½¬æ¢é”™è¯¯:', error, 'é“¾æ¥:', url);
            // è¿™é‡Œå¯ä»¥æ·»åŠ é”™è¯¯ä¸ŠæŠ¥é€»è¾‘
        }

        // å…¨å±€é”™è¯¯å¤„ç†
        window.addEventListener('error', function (e) {
            reportError(e.error, document.getElementById('shareLink').value);
        });

        // æ·»åŠ CSSåŠ¨ç”»
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            
            .history-item {
                padding: 10px;
                border-bottom: 1px solid rgba(255,255,255,0.1);
                cursor: pointer;
                transition: background 0.2s;
            }
            
            .history-item:hover {
                background: rgba(255,255,255,0.1);
            }
        `;
        document.head.appendChild(style);

        // åˆå§‹åŒ–å®Œæˆæç¤º
        console.log('æ™ºèƒ½ç½‘ç›˜ç›´é“¾è½¬æ¢å™¨å·²å°±ç»ªï¼');
        console.log('æ”¯æŒçš„å¹³å°:', Object.keys(platforms));
    </script>
</body>

</html>